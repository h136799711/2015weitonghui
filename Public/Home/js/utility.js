function handleResponse(e,t){return function(n,r){try{var i=$.parseJSON(n);if(i!==null)switch(i.code){case 0:(e||Callbacks.showNotice)(i,undefined,r);break;case"INVALID":case"ERROR":default:(t||Callbacks.alert)(i,undefined,r)}else alert(n)}catch(s){alert(n)}}}function isImage(e,t){if(!/\.(gif|jpeg|jpg|png)$/i.test(e.value))return alert("请选择JPG/PNG/GIF类型的图片"),!1;if(e.files){var n=e.files[0];if(n.type&&!/^image\/(gif|jpeg|png)$/i.test(n.type))return alert("请选择JPG/PNG/GIF类型的图片"),!1;if(t&&n.size&&n.size>t)return alert("文件尺寸不能大于"+formatUnit(t)),!1}return!0}var $window=$(window);$.alertModal=function(e,t,n){var r='<div class="modal hide fade modal-alert"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3>'+(t||"提示")+"</h3></div>"+'<div class="modal-body"><p>'+e.replace(/\n/g,"<br />")+"</p></div>"+'<div class="modal-footer"><a href="#" data-dismiss="modal" class="btn btn-primary">确定</a></div>'+"</div>";return n=$.extend({keyboard:!0,backdrop:!0},n),$(r).modal(n)},$.fn.freeze=function(){$.each(this.find("button[type=submit]"),function(){this.disabled=!0}),$.each(this.find("input, select, textarea"),function(){this.readOnly=!0})},$.fn.unfreeze=function(){$.each(this.find("button[type=submit]"),function(){this.disabled=!1}),$.each(this.find("input, select, textarea"),function(){this.readOnly=!1})},$.fn.ajaxsubmit=function(e,t){var n=this;$.ajax({url:n.attr("action"),type:n.attr("method").toUpperCase(),data:n.serialize(),beforeSend:function(){n.freeze()},complete:function(){n.unfreeze()},success:e||Callbacks.showNotice,error:function(e,n,r){var i=$.parseJSON(e.responseText);i===null?$.alertModal(r+":"+e.responseText):(t||Callbacks.alert)(i,n,e)}})},$.fn.fileSubmit=function(e){e=$.extend({success:$.noop,error:Callbacks.alert,complete:$.noop,uploadProgress:$.noop},e);var t=this[0],n;if(typeof XMLHttpRequest=="undefined"||typeof FormData=="undefined"||(n=new XMLHttpRequest).upload===undefined){var r="hidden-iframe-"+Math.round(Math.random()*1e6);this.attr("target",r);var i=$('<iframe name="'+r+'" style="display:none;"></iframe>').insertAfter(this);t.submit(),i.load(function(t){e.complete(t);var n=(this.contentWindow||this.contentDocument).document;if(n.title){var r={"413 Request Entity Too Large":"文件尺寸过大","502 Bad Gateway":"服务器内部错误，请通知管理员","502 Bad Gateway":"服务器网关错误，请通知管理员"};alert(r[n.title]||n.title)}else handleResponse(e.success,e.error)(n.getElementsByTagName("pre")[0].innerHTML)})}else{var s=new FormData;$.each(this.serializeArray(),function(e,t){s.append(t.name,t.value)});var o=this.find("input[type=file]");s.append(o.attr("name"),o[0].files[0]),n.addEventListener("error",function(e){alert("连接不到服务器，请检查你的网络连接")},!1),n.addEventListener("load",function(t){e.complete(t);var r=t.target.status;if(r>=200&&r<300||r==304)handleResponse(e.success,e.error)(this.responseText,n);else{var i={413:"文件尺寸过大",500:"服务器内部错误，请通知管理员",502:"服务器网关错误，请通知管理员"};alert(i[r]||t.target.statusText)}},!1),$.each(["abort","loadstart","loadend","progress","timeout"],function(){e[this]&&n.addEventListener(this,e[this],!1)}),n.upload.addEventListener("progress",e.uploadProgress,!1),n.open(t.method,t.action,!0),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(s)}};var formatUnit=function(e){var t=["B","kB","MB","GB","TB"],n=0;while(e>=1024)n++,e/=1024;return e.toFixed(2)+t[n]};$.fn.progressbar=function(e,t){typeof e=="object"&&(t=e,e="options");var n=this.find(".progressbar-value");n.length==0&&(this.parent().find(".progress-compat").remove(),this.show(),n=$('<div class="progressbar-value ui-corner-left"></div>').appendTo(this));switch(e){case"value":var r=(t/this.data("total")*100).toFixed(0);n.toggle(t>0).toggleClass("ui-corner-right",t>=this.data("total")).width(r+"%");break;case"options":t.total&&this.data("total",t.total),n=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this);break;default:}};var Duoshuo=window.Duoshuo={timeOffset:0,serviceNames:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",netease:"网易微博",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",msn:"MSN"},serviceUrls:{weibo:"http://weibo.com/",qq:"http://www.qq.com/",qzone:"http://qzone.qq.com/",qqt:"http://t.qq.com/",renren:"http://www.renren.com/",douban:"http://www.douban.com/",netease:"http://t.163.com/",kaixin:"http://www.kaixin001.com/",sohu:"http://t.sohu.com/",baidu:"http://www.baidu.com/",msn:"http://www.live.com/"},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(e){var t=Duoshuo.parseDate(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(e,t){t=t||new Date-Duoshuo.timeOffset;var n=Duoshuo.parseDate(e),r=(t-n)/1e3;return r<10?"刚刚":r<60?Math.round(r)+"秒前":r<3600?Math.round(r/60)+"分钟前":r<86400?Math.round(r/3600)+"小时前":((new Date(t)).getFullYear()==n.getFullYear()?"":n.getFullYear()+"年")+(n.getMonth()+1)+"月"+n.getDate()+"日"},expireTime:function(e){var t=Duoshuo.parseDate(e),n=new Date,r=(t-n)/1e3;return r<10?"已过期":r<60?"1分钟内过期":r<3600?Math.round(r/60)+"分钟后过期":r<86400?Math.round(r/3600)+"小时后过期":r<432e3?Math.round(r/86400)+"天后过期":"有效期至:"+(n.getFullYear()==t.getFullYear()?"":t.getFullYear()+"年")+(t.getMonth()+1)+"月"+t.getDate()+"日"}},Callbacks=window.Callbacks={alert:function(e,t,n){$.alertModal(e.errorMessage)},redirect:function(e){return function(t,n){window.location=t.response[e]}},alertMessage:function(e){var t=$('<div class="alert alert-block alert-success fade in"><a href="#" data-dismiss="alert" class="close">×</a><p></p></div>');e.code==0?($("#main .scrollable")[0].scrollTop=0,t.addClass("success").find("p").text("已保存")):t.addClass("error").find("p").text(e.message),oMain.find("post").prepend(t)},mAlertMessage:function(e){return function(){var t=$('<div class="alert alert-block alert-success fade in"><a class="close" data-dismiss="alert" href="#">&times;</a><p></p></div>');t.addClass("success").find("p").text(e),$(".content .nav-pills").after(t),window.scrollTo(0,0)}},progress:function(e,t){return function(n){var r="正在上传中："+formatUnit(n.loaded);n.lengthComputable&&(e.data("total",n.total).progressbar("value",n.loaded),r+="/"+formatUnit(n.total)),t.html(r)}}};